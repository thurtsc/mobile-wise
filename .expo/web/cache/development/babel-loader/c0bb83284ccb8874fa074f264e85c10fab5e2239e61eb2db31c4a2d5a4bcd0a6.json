{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\licia\\\\OneDrive\\\\\\xC1rea de Trabalho\\\\Financas\\\\src\\\\contexts\\\\auth.js\";\nimport React, { createContext, useState, useEffect } from 'react';\nimport api from '../services/api';\nimport { useNavigation } from '@react-navigation/native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = createContext({});\nfunction AuthProvider({\n  children\n}) {\n  const [user, setUser] = useState(null);\n  const [loadingAuth, setLoadingAuth] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const navigation = useNavigation();\n  useEffect(() => {\n    async function loadStorage() {\n      const storageUser = await AsyncStorage.getItem('@finToken');\n      if (storageUser) {\n        const response = await api.get('/me', {\n          headers: {\n            'Authorization': `Bearer ${storageUser}`\n          }\n        }).catch(() => {\n          setUser(null);\n        });\n        api.defaults.headers['Authorization'] = `Bearer ${storageUser}`;\n        setUser(response.data);\n        setLoading(false);\n      }\n      setLoading(false);\n    }\n    loadStorage();\n  }, []);\n  async function signUp(email, password, nome) {\n    setLoadingAuth(true);\n    try {\n      const response = await api.post('/users', {\n        name: nome,\n        password: password,\n        email: email\n      });\n      setLoadingAuth(false);\n      navigation.goBack();\n    } catch (err) {\n      console.log(\"ERRO AO CADASTRAR\", err);\n      setLoadingAuth(false);\n    }\n  }\n  async function signIn(email, password) {\n    setLoadingAuth(true);\n    try {\n      const response = await api.post('/login', {\n        email: email,\n        password: password\n      });\n      const {\n        id,\n        name,\n        token\n      } = response.data;\n      const data = {\n        id,\n        name,\n        token,\n        email\n      };\n      await AsyncStorage.setItem('@finToken', token);\n      api.defaults.headers['Authorization'] = `Bearer ${token}`;\n      setUser({\n        id,\n        name,\n        email\n      });\n      setLoadingAuth(false);\n    } catch (err) {\n      console.log(\"ERRO AO LOGAR \", err);\n      setLoadingAuth(false);\n    }\n  }\n  async function signOut() {\n    await AsyncStorage.clear().then(() => {\n      setUser(null);\n    });\n  }\n  return _jsxDEV(AuthContext.Provider, {\n    value: {\n      signed: !!user,\n      user,\n      signUp,\n      signIn,\n      signOut,\n      loadingAuth,\n      loading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n}\nexport default AuthProvider;","map":{"version":3,"names":["React","createContext","useState","useEffect","api","useNavigation","AsyncStorage","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","user","setUser","loadingAuth","setLoadingAuth","loading","setLoading","navigation","loadStorage","storageUser","getItem","response","get","headers","catch","defaults","data","signUp","email","password","nome","post","name","goBack","err","console","log","signIn","id","token","setItem","signOut","clear","then","Provider","value","signed","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["C:/Users/licia/OneDrive/Ãrea de Trabalho/Financas/src/contexts/auth.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport api from '../services/api';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nexport const AuthContext = createContext({});\r\n\r\nfunction AuthProvider({ children }){\r\n  const [user, setUser] = useState(null); \r\n  const [loadingAuth, setLoadingAuth] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const navigation = useNavigation();\r\n\r\n  useEffect(() => {\r\n    async function loadStorage(){\r\n      const storageUser = await AsyncStorage.getItem('@finToken');\r\n\r\n      if(storageUser){\r\n        const response = await api.get('/me', {\r\n          headers:{\r\n            'Authorization': `Bearer ${storageUser}`\r\n          }\r\n        })\r\n        .catch(()=>{\r\n          setUser(null);\r\n        })\r\n\r\n        api.defaults.headers['Authorization'] = `Bearer ${storageUser}`;\r\n        setUser(response.data);\r\n        setLoading(false);\r\n      }\r\n\r\n      setLoading(false);\r\n\r\n    }\r\n\r\n    loadStorage();\r\n  }, [])\r\n\r\n\r\n  async function signUp(email, password, nome){\r\n    setLoadingAuth(true);\r\n\r\n    try{\r\n      const response = await api.post('/users', {\r\n       name: nome,\r\n       password: password,\r\n       email: email,\r\n      })\r\n      setLoadingAuth(false);\r\n\r\n      navigation.goBack();\r\n\r\n    }catch(err){\r\n      console.log(\"ERRO AO CADASTRAR\", err);\r\n      setLoadingAuth(false);\r\n    }\r\n  }\r\n\r\n  async function signIn(email, password){\r\n    setLoadingAuth(true);\r\n\r\n    try{\r\n      const response = await api.post('/login', {\r\n        email: email,\r\n        password: password\r\n      })\r\n\r\n      const { id, name, token } = response.data;\r\n\r\n      const data = {\r\n        id,\r\n        name,\r\n        token,\r\n        email,\r\n      };\r\n\r\n      await AsyncStorage.setItem('@finToken', token);\r\n\r\n      api.defaults.headers['Authorization'] = `Bearer ${token}`;\r\n\r\n      setUser({\r\n        id,\r\n        name,\r\n        email,\r\n      })\r\n\r\n      setLoadingAuth(false);\r\n\r\n    }catch(err){\r\n      console.log(\"ERRO AO LOGAR \", err);\r\n      setLoadingAuth(false);\r\n    }\r\n  }\r\n\r\n  async function signOut(){\r\n    await AsyncStorage.clear()\r\n    .then(() => {\r\n      setUser(null);\r\n    })\r\n  }\r\n\r\n  return(\r\n    <AuthContext.Provider value={{ signed: !!user, user, signUp, signIn, signOut, loadingAuth, loading }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport default AuthProvider;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}