{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useState, useEffect } from 'react';\nimport api from \"../services/api\";\nimport { useNavigation } from '@react-navigation/native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var AuthContext = createContext({});\nfunction AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loadingAuth = _useState4[0],\n    setLoadingAuth = _useState4[1];\n  var _useState5 = useState(true),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  var navigation = useNavigation();\n  useEffect(function () {\n    function loadStorage() {\n      return _loadStorage.apply(this, arguments);\n    }\n    function _loadStorage() {\n      _loadStorage = _asyncToGenerator(function* () {\n        var storageUser = yield AsyncStorage.getItem('@finToken');\n        if (storageUser) {\n          var response = yield api.get('/me', {\n            headers: {\n              'Authorization': `Bearer ${storageUser}`\n            }\n          }).catch(function () {\n            setUser(null);\n          });\n          api.defaults.headers['Authorization'] = `Bearer ${storageUser}`;\n          setUser(response.data);\n          setLoading(false);\n        }\n        setLoading(false);\n      });\n      return _loadStorage.apply(this, arguments);\n    }\n    loadStorage();\n  }, []);\n  function signUp(_x, _x2, _x3) {\n    return _signUp.apply(this, arguments);\n  }\n  function _signUp() {\n    _signUp = _asyncToGenerator(function* (email, password, nome) {\n      setLoadingAuth(true);\n      try {\n        var response = yield api.post('/users', {\n          name: nome,\n          password: password,\n          email: email\n        });\n        setLoadingAuth(false);\n        navigation.goBack();\n      } catch (err) {\n        console.log(\"ERRO AO CADASTRAR\", err);\n        setLoadingAuth(false);\n      }\n    });\n    return _signUp.apply(this, arguments);\n  }\n  function signIn(_x4, _x5) {\n    return _signIn.apply(this, arguments);\n  }\n  function _signIn() {\n    _signIn = _asyncToGenerator(function* (email, password) {\n      setLoadingAuth(true);\n      try {\n        var response = yield api.post('/login', {\n          email: email,\n          password: password\n        });\n        var _response$data = response.data,\n          id = _response$data.id,\n          name = _response$data.name,\n          token = _response$data.token;\n        var data = {\n          id: id,\n          name: name,\n          token: token,\n          email: email\n        };\n        yield AsyncStorage.setItem('@finToken', token);\n        api.defaults.headers['Authorization'] = `Bearer ${token}`;\n        setUser({\n          id: id,\n          name: name,\n          email: email\n        });\n        setLoadingAuth(false);\n      } catch (err) {\n        console.log(\"ERRO AO LOGAR \", err);\n        setLoadingAuth(false);\n      }\n    });\n    return _signIn.apply(this, arguments);\n  }\n  function signOut() {\n    return _signOut.apply(this, arguments);\n  }\n  function _signOut() {\n    _signOut = _asyncToGenerator(function* () {\n      yield AsyncStorage.clear().then(function () {\n        setUser(null);\n      });\n    });\n    return _signOut.apply(this, arguments);\n  }\n  return _jsx(AuthContext.Provider, {\n    value: {\n      signed: !!user,\n      user: user,\n      signUp: signUp,\n      signIn: signIn,\n      signOut: signOut,\n      loadingAuth: loadingAuth,\n      loading: loading\n    },\n    children: children\n  });\n}\nexport default AuthProvider;","map":{"version":3,"names":["React","createContext","useState","useEffect","api","useNavigation","AsyncStorage","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","loadingAuth","setLoadingAuth","_useState5","_useState6","loading","setLoading","navigation","loadStorage","_loadStorage","apply","arguments","_asyncToGenerator","storageUser","getItem","response","get","headers","catch","defaults","data","signUp","_x","_x2","_x3","_signUp","email","password","nome","post","name","goBack","err","console","log","signIn","_x4","_x5","_signIn","_response$data","id","token","setItem","signOut","_signOut","clear","then","Provider","value","signed"],"sources":["C:/Users/licia/OneDrive/Área de Trabalho/Financas/src/contexts/auth.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport api from '../services/api';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nexport const AuthContext = createContext({});\r\n\r\nfunction AuthProvider({ children }){\r\n  const [user, setUser] = useState(null); \r\n  const [loadingAuth, setLoadingAuth] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const navigation = useNavigation();\r\n\r\n  useEffect(() => {\r\n    async function loadStorage(){\r\n      const storageUser = await AsyncStorage.getItem('@finToken');\r\n\r\n      if(storageUser){\r\n        const response = await api.get('/me', {\r\n          headers:{\r\n            'Authorization': `Bearer ${storageUser}`\r\n          }\r\n        })\r\n        .catch(()=>{\r\n          setUser(null);\r\n        })\r\n\r\n        api.defaults.headers['Authorization'] = `Bearer ${storageUser}`;\r\n        setUser(response.data);\r\n        setLoading(false);\r\n      }\r\n\r\n      setLoading(false);\r\n\r\n    }\r\n\r\n    loadStorage();\r\n  }, [])\r\n\r\n\r\n  async function signUp(email, password, nome){\r\n    setLoadingAuth(true);\r\n\r\n    try{\r\n      const response = await api.post('/users', {\r\n       name: nome,\r\n       password: password,\r\n       email: email,\r\n      })\r\n      setLoadingAuth(false);\r\n\r\n      navigation.goBack();\r\n\r\n    }catch(err){\r\n      console.log(\"ERRO AO CADASTRAR\", err);\r\n      setLoadingAuth(false);\r\n    }\r\n  }\r\n\r\n  async function signIn(email, password){\r\n    setLoadingAuth(true);\r\n\r\n    try{\r\n      const response = await api.post('/login', {\r\n        email: email,\r\n        password: password\r\n      })\r\n\r\n      const { id, name, token } = response.data;\r\n\r\n      const data = {\r\n        id,\r\n        name,\r\n        token,\r\n        email,\r\n      };\r\n\r\n      await AsyncStorage.setItem('@finToken', token);\r\n\r\n      api.defaults.headers['Authorization'] = `Bearer ${token}`;\r\n\r\n      setUser({\r\n        id,\r\n        name,\r\n        email,\r\n      })\r\n\r\n      setLoadingAuth(false);\r\n\r\n    }catch(err){\r\n      console.log(\"ERRO AO LOGAR \", err);\r\n      setLoadingAuth(false);\r\n    }\r\n  }\r\n\r\n  async function signOut(){\r\n    await AsyncStorage.clear()\r\n    .then(() => {\r\n      setUser(null);\r\n    })\r\n  }\r\n\r\n  return(\r\n    <AuthContext.Provider value={{ signed: !!user, user, signUp, signIn, signOut, loadingAuth, loading }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport default AuthProvider;\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}